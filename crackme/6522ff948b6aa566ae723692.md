# 6522ff948b6aa566ae723692


## Walkthrough
For this crackme, I work with [IDA Free](https://hex-rays.com/ida-free/) on a linux Virtual Machine.
IDA gives us graph view, function detection and even better, a pseudocode generator.

I used two approaches for the problems:
1. [patching](#patching) : any key will work
2. [keygen](#keygen) : generate valid keys

The crackme author does provide some valid keys to help us, and I used two of them to trace code execution, more details below.
```
KFKf-1kEH-0P0B-yzpd
fao1-tph5-NKrn-0Gx5
BkZP-LLnt-TDsF-0HIt
[...]
```


### Patching

As this is not prohibited, one solution is to make a crack, a modified version of the program which accepts any key.
This is not generally considered the clean way of doing things, but it is still a solution.
In our case, we will just use it to understand where the **key check** is performed.

First, to debug our program, we need to avoid the debugger detection:  
![image](https://github.com/Cyril-Meyer/RCE/assets/69190238/c2eb1a64-92ed-4085-9523-dc1233e86e21)

The jump responsible for this is the following `JZ`, placed after the `ptrace` function call.
![image](https://github.com/Cyril-Meyer/RCE/assets/69190238/e7b85f27-daaf-459e-b2e0-8f641c269c3b)

If you don't know `ptrace`, heres a quick description :
> The ptrace() system call provides a means by which one process (the "tracer") may observe and control the execution of another process (the "tracee"), and examine and change the tracee's memory and registers.
> It is primarily used to implement breakpoint debugging and system call tracing.

We can replace this jump with `NOP` instructions, or in my case, a `JNZ` which cause the program to only work when debugged (my idea is to make a fast patch to understand what is important or not).

The second jump responsible for the `Error: Invalid key` message is this `JNZ` (in the blue colored box).
This jump is triggerd depending of `sub_19B0` return value.

![image](https://github.com/Cyril-Meyer/RCE/assets/69190238/5d169e9f-a2dc-4767-b6bf-ec2a506f50d4)

We can change it into a `JMP` to always jump to the right location.  
Here is the list of applied patches :

![image](https://github.com/Cyril-Meyer/RCE/assets/69190238/76ebb6d6-0633-4697-a6d3-3d4d86e1b1e7)

And the result is a program which accept any key, including valid ones.

![image](https://github.com/Cyril-Meyer/RCE/assets/69190238/cc3dbbb6-59d6-454f-9c31-78362271fe6d)

Okay, now let's be serious, we're not going to stop there.
But what could we learn?
1. We can easily deactivate debug detection to be able to perform dynamic code analysis
2. The key check is not done in the main but in the `sub_19B0` function


### Keygen
